<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Analytics Dashboard - EduPlatform</title>
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/blazeface@latest/dist/blazeface.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@latest/dist/chart.min.js"></script>
    <script src="js/config.js"></script>
    <script src="js/ml-manager.js"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#1173d4",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101922",
                        "foreground-light": "#111418",
                        "foreground-dark": "#f6f7f8",
                        "card-light": "#ffffff",
                        "card-dark": "#1b2734",
                        "subtle-light": "#617589",
                        "subtle-dark": "#a0b3c6",
                        "border-light": "#e5e7eb",
                        "border-dark": "#374151",
                    },
                    fontFamily: {
                        display: ["Manrope", "sans-serif"],
                    },
                },
            },
        };
    </script>
</head>
<body class="font-display bg-background-light dark:bg-background-dark text-foreground-light dark:text-foreground-dark">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-card-light dark:bg-card-dark border-b border-border-light dark:border-border-dark shadow-sm">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center gap-4">
                        <div class="text-primary size-6">
                            <svg fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                                <path d="M4 4H17.3334V17.3334H30.6666V30.6666H44V44H4V4Z" fill="currentColor"></path>
                            </svg>
                        </div>
                        <h1 class="text-xl font-bold">AI Analytics Dashboard</h1>
                        <div id="ml-status" class="px-3 py-1 bg-yellow-100 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-400 rounded-full text-sm">
                            <span class="w-2 h-2 bg-yellow-500 rounded-full inline-block mr-2"></span>
                            Loading
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <button id="theme-toggle" class="p-2 rounded-lg hover:bg-background-light dark:hover:bg-background-dark transition-colors">
                            <svg class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                            </svg>
                            <svg class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                            </svg>
                        </button>
                        <a href="index.html" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
                            Back to Home
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- AI Features Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Facial Recognition -->
                <div class="bg-card-light dark:bg-card-dark p-6 rounded-xl shadow-sm border border-border-light dark:border-border-dark">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/20 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                        <h3 class="font-semibold">Facial Recognition</h3>
                    </div>
                    <p class="text-sm text-subtle-light dark:text-subtle-dark mb-4">Track attendance and engagement</p>
                    <button id="start-face-detection" class="w-full px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                        Start Detection
                    </button>
                </div>

                <!-- Emotion Detection -->
                <div class="bg-card-light dark:bg-card-dark p-6 rounded-xl shadow-sm border border-border-light dark:border-border-dark">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-12 h-12 bg-green-100 dark:bg-green-900/20 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h3 class="font-semibold">Emotion Detection</h3>
                    </div>
                    <p class="text-sm text-subtle-light dark:text-subtle-dark mb-4">Monitor student emotions</p>
                    <button id="start-emotion-detection" class="w-full px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                        Start Detection
                    </button>
                </div>

                <!-- Content Recommendation -->
                <div class="bg-card-light dark:bg-card-dark p-6 rounded-xl shadow-sm border border-border-light dark:border-border-dark">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/20 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                            </svg>
                        </div>
                        <h3 class="font-semibold">AI Recommendations</h3>
                    </div>
                    <p class="text-sm text-subtle-light dark:text-subtle-dark mb-4">Personalized content suggestions</p>
                    <button id="get-recommendations" class="w-full px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors">
                        Get Recommendations
                    </button>
                </div>

                <!-- Predictive Analytics -->
                <div class="bg-card-light dark:bg-card-dark p-6 rounded-xl shadow-sm border border-border-light dark:border-border-dark">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-12 h-12 bg-orange-100 dark:bg-orange-900/20 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-orange-600 dark:text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                        <h3 class="font-semibold">Predictive Analytics</h3>
                    </div>
                    <p class="text-sm text-subtle-light dark:text-subtle-dark mb-4">Forecast learning outcomes</p>
                    <button id="run-predictions" class="w-full px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">
                        Run Analysis
                    </button>
                </div>
            </div>

            <!-- Analytics Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Engagement Chart -->
                <div class="bg-card-light dark:bg-card-dark p-6 rounded-xl shadow-sm border border-border-light dark:border-border-dark">
                    <h3 class="text-lg font-semibold mb-4">Student Engagement</h3>
                    <canvas id="engagement-chart" width="400" height="200"></canvas>
                </div>

                <!-- Performance Chart -->
                <div class="bg-card-light dark:bg-card-dark p-6 rounded-xl shadow-sm border border-border-light dark:border-border-dark">
                    <h3 class="text-lg font-semibold mb-4">Performance Trends</h3>
                    <canvas id="performance-chart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- AI Insights -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <!-- Learning Patterns -->
                <div class="bg-card-light dark:bg-card-dark p-6 rounded-xl shadow-sm border border-border-light dark:border-border-dark">
                    <h3 class="text-lg font-semibold mb-4">Learning Patterns</h3>
                    <div id="learning-patterns" class="space-y-3">
                        <div class="text-center text-subtle-light dark:text-subtle-dark py-4">
                            <p>Click "Run Analysis" to see patterns</p>
                        </div>
                    </div>
                </div>

                <!-- Risk Factors -->
                <div class="bg-card-light dark:bg-card-dark p-6 rounded-xl shadow-sm border border-border-light dark:border-border-dark">
                    <h3 class="text-lg font-semibold mb-4">Risk Factors</h3>
                    <div id="risk-factors" class="space-y-3">
                        <div class="text-center text-subtle-light dark:text-subtle-dark py-4">
                            <p>Click "Run Analysis" to see risks</p>
                        </div>
                    </div>
                </div>

                <!-- Recommendations -->
                <div class="bg-card-light dark:bg-card-dark p-6 rounded-xl shadow-sm border border-border-light dark:border-border-dark">
                    <h3 class="text-lg font-semibold mb-4">AI Recommendations</h3>
                    <div id="ai-recommendations" class="space-y-3">
                        <div class="text-center text-subtle-light dark:text-subtle-dark py-4">
                            <p>Click "Get Recommendations" to see suggestions</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Camera Feed -->
            <div id="camera-section" class="hidden">
                <div class="bg-card-light dark:bg-card-dark p-6 rounded-xl shadow-sm border border-border-light dark:border-border-dark">
                    <h3 class="text-lg font-semibold mb-4">Live Camera Feed</h3>
                    <div class="relative">
                        <video id="camera-feed" autoplay muted class="w-full max-w-md mx-auto rounded-lg"></video>
                        <canvas id="detection-canvas" class="absolute top-0 left-0 w-full max-w-md mx-auto rounded-lg"></canvas>
                    </div>
                    <div class="mt-4 text-center">
                        <button id="stop-camera" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                            Stop Camera
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // AI Analytics Dashboard Functionality
        document.addEventListener('DOMContentLoaded', function() {
            const mlManager = new MLManager();
            let cameraStream = null;
            let detectionInterval = null;
            let engagementChart = null;
            let performanceChart = null;

            // Initialize theme toggle
            initializeThemeToggle();
            
            // Initialize event listeners
            initializeEventListeners();

            // Initialize charts
            initializeCharts();

            // Check ML status
            checkMLStatus();

            function initializeThemeToggle() {
                const themeToggle = document.getElementById('theme-toggle');
                const html = document.documentElement;

                const currentTheme = localStorage.getItem('theme') || 'light';
                html.classList.toggle('dark', currentTheme === 'light');

                themeToggle.addEventListener('click', () => {
                    html.classList.toggle('dark');
                    const newTheme = html.classList.contains('dark') ? 'dark' : 'light';
                    localStorage.setItem('theme', newTheme);
                });
            }

            function initializeEventListeners() {
                // AI feature buttons
                document.getElementById('start-face-detection').addEventListener('click', startFaceDetection);
                document.getElementById('start-emotion-detection').addEventListener('click', startEmotionDetection);
                document.getElementById('get-recommendations').addEventListener('click', getRecommendations);
                document.getElementById('run-predictions').addEventListener('click', runPredictions);
                document.getElementById('stop-camera').addEventListener('click', stopCamera);
            }

            function initializeCharts() {
                // Engagement Chart
                const engagementCtx = document.getElementById('engagement-chart').getContext('2d');
                engagementChart = new Chart(engagementCtx, {
                    type: 'line',
                    data: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6'],
                        datasets: [{
                            label: 'Engagement Score',
                            data: [65, 72, 68, 75, 80, 85],
                            borderColor: 'rgb(17, 115, 212)',
                            backgroundColor: 'rgba(17, 115, 212, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });

                // Performance Chart
                const performanceCtx = document.getElementById('performance-chart').getContext('2d');
                performanceChart = new Chart(performanceCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Quizzes', 'Assignments', 'Projects', 'Exams'],
                        datasets: [{
                            label: 'Average Score',
                            data: [85, 78, 92, 88],
                            backgroundColor: [
                                'rgba(17, 115, 212, 0.8)',
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(168, 85, 247, 0.8)',
                                'rgba(249, 115, 22, 0.8)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }

            async function checkMLStatus() {
                const status = mlManager.getModelStatus();
                const statusElement = document.getElementById('ml-status');
                
                if (status.isInitialized && !status.isLoading) {
                    statusElement.className = 'px-3 py-1 bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-400 rounded-full text-sm';
                    statusElement.innerHTML = '<span class="w-2 h-2 bg-green-500 rounded-full inline-block mr-2"></span>Ready';
                } else if (status.isLoading) {
                    statusElement.className = 'px-3 py-1 bg-yellow-100 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-400 rounded-full text-sm';
                    statusElement.innerHTML = '<span class="w-2 h-2 bg-yellow-500 rounded-full inline-block mr-2"></span>Loading';
                } else {
                    statusElement.className = 'px-3 py-1 bg-red-100 dark:bg-red-900/20 text-red-800 dark:text-red-400 rounded-full text-sm';
                    statusElement.innerHTML = '<span class="w-2 h-2 bg-red-500 rounded-full inline-block mr-2"></span>Error';
                }
            }

            async function startFaceDetection() {
                try {
                    await startCamera();
                    document.getElementById('camera-section').classList.remove('hidden');
                    
                    // Start face detection
                    detectionInterval = setInterval(async () => {
                        await detectFaces();
                    }, 1000);
                    
                    console.log('✅ Face detection started');
                } catch (error) {
                    console.error('❌ Failed to start face detection:', error);
                    alert('Failed to start face detection. Please check camera permissions.');
                }
            }

            async function startEmotionDetection() {
                try {
                    await startCamera();
                    document.getElementById('camera-section').classList.remove('hidden');
                    
                    // Start emotion detection
                    detectionInterval = setInterval(async () => {
                        await detectEmotions();
                    }, 1000);
                    
                    console.log('✅ Emotion detection started');
                } catch (error) {
                    console.error('❌ Failed to start emotion detection:', error);
                    alert('Failed to start emotion detection. Please check camera permissions.');
                }
            }

            async function startCamera() {
                try {
                    cameraStream = await navigator.mediaDevices.getUserMedia({ 
                        video: { width: 640, height: 480 } 
                    });
                    
                    const video = document.getElementById('camera-feed');
                    video.srcObject = cameraStream;
                } catch (error) {
                    throw new Error('Camera access denied');
                }
            }

            async function detectFaces() {
                try {
                    const video = document.getElementById('camera-feed');
                    const canvas = document.getElementById('detection-canvas');
                    const ctx = canvas.getContext('2d');
                    
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    
                    const predictions = await mlManager.detectFaces(video);
                    
                    // Clear canvas
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    // Draw face bounding boxes
                    predictions.forEach(prediction => {
                        const { topLeft, bottomRight } = prediction;
                        const x = topLeft[0];
                        const y = topLeft[1];
                        const width = bottomRight[0] - topLeft[0];
                        const height = bottomRight[1] - topLeft[1];
                        
                        ctx.strokeStyle = '#00ff00';
                        ctx.lineWidth = 2;
                        ctx.strokeRect(x, y, width, height);
                        
                        ctx.fillStyle = '#00ff00';
                        ctx.font = '16px Arial';
                        ctx.fillText('Face Detected', x, y - 5);
                    });
                } catch (error) {
                    console.error('Face detection error:', error);
                }
            }

            async function detectEmotions() {
                try {
                    const video = document.getElementById('camera-feed');
                    const canvas = document.getElementById('detection-canvas');
                    const ctx = canvas.getContext('2d');
                    
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    
                    const predictions = await mlManager.detectFaces(video);
                    
                    // Clear canvas
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    // Detect emotions for each face
                    for (const prediction of predictions) {
                        const { topLeft, bottomRight } = prediction;
                        const x = topLeft[0];
                        const y = topLeft[1];
                        const width = bottomRight[0] - topLeft[0];
                        const height = bottomRight[1] - topLeft[1];
                        
                        // Extract face region
                        const faceCanvas = document.createElement('canvas');
                        const faceCtx = faceCanvas.getContext('2d');
                        faceCanvas.width = width;
                        faceCanvas.height = height;
                        faceCtx.drawImage(video, x, y, width, height, 0, 0, width, height);
                        
                        // Detect emotion
                        const emotion = await mlManager.detectEmotion(faceCanvas);
                        
                        // Draw bounding box and emotion
                        ctx.strokeStyle = '#ff0000';
                        ctx.lineWidth = 2;
                        ctx.strokeRect(x, y, width, height);
                        
                        ctx.fillStyle = '#ff0000';
                        ctx.font = '16px Arial';
                        ctx.fillText(`${emotion.emotion} (${(emotion.confidence * 100).toFixed(1)}%)`, x, y - 5);
                    }
                } catch (error) {
                    console.error('Emotion detection error:', error);
                }
            }

            async function getRecommendations() {
                try {
                    const mockUserHistory = {
                        totalCourses: 5,
                        averageGrade: 85,
                        studyTime: 20,
                        preferredCategories: ['programming', 'mathematics'],
                        coursesCompleted: ['course1', 'course2'],
                        coursesInProgress: ['course3']
                    };

                    const mockCourses = [
                        { id: 'course4', name: 'Advanced JavaScript', category: 'programming', difficulty: 3, duration: 40, rating: 4.5, enrollmentCount: 150 },
                        { id: 'course5', name: 'Data Structures', category: 'programming', difficulty: 4, duration: 60, rating: 4.8, enrollmentCount: 200 },
                        { id: 'course6', name: 'Calculus II', category: 'mathematics', difficulty: 4, duration: 50, rating: 4.2, enrollmentCount: 120 }
                    ];

                    const recommendations = await mlManager.getRecommendations('user1', mockUserHistory, mockCourses);
                    
                    displayRecommendations(recommendations);
                } catch (error) {
                    console.error('❌ Failed to get recommendations:', error);
                    alert('Failed to get recommendations. Please try again.');
                }
            }

            function displayRecommendations(recommendations) {
                const container = document.getElementById('ai-recommendations');
                container.innerHTML = recommendations.map(rec => `
                    <div class="p-3 bg-gray-100 dark:bg-gray-700 rounded-lg">
                        <h4 class="font-semibold text-sm">${rec.courseName}</h4>
                        <p class="text-xs text-subtle-light dark:text-subtle-dark">
                            Rating: ${(rec.predictedRating * 5).toFixed(1)}/5
                        </p>
                    </div>
                `).join('');
            }

            async function runPredictions() {
                try {
                    const mockStudentData = {
                        attendanceRate: 0.85,
                        assignmentScore: 0.78,
                        quizScore: 0.82,
                        participationScore: 0.75,
                        studyTime: 15,
                        previousGrades: 0.80,
                        courseDifficulty: 3,
                        teacherRating: 4.2,
                        peerInteraction: 0.70,
                        technologyUsage: 0.85
                    };

                    const prediction = await mlManager.predictLearningOutcome(mockStudentData);
                    const patterns = mlManager.analyzeLearningPatterns(mockStudentData);
                    
                    displayPredictions(prediction, patterns);
                } catch (error) {
                    console.error('❌ Failed to run predictions:', error);
                    alert('Failed to run predictions. Please try again.');
                }
            }

            function displayPredictions(prediction, patterns) {
                // Display learning patterns
                const patternsContainer = document.getElementById('learning-patterns');
                patternsContainer.innerHTML = `
                    <div class="space-y-2">
                        <div class="p-2 bg-blue-100 dark:bg-blue-900/20 rounded">
                            <p class="text-sm font-medium">Study Pattern: ${patterns.studyTimePattern.pattern}</p>
                            <p class="text-xs text-subtle-light dark:text-subtle-dark">${patterns.studyTimePattern.recommendation}</p>
                        </div>
                        <div class="p-2 bg-green-100 dark:bg-green-900/20 rounded">
                            <p class="text-sm font-medium">Performance: ${patterns.performanceTrend.trend}</p>
                            <p class="text-xs text-subtle-light dark:text-subtle-dark">${patterns.performanceTrend.recommendation}</p>
                        </div>
                        <div class="p-2 bg-purple-100 dark:bg-purple-900/20 rounded">
                            <p class="text-sm font-medium">Learning Style: ${patterns.learningStyle.style}</p>
                            <p class="text-xs text-subtle-light dark:text-subtle-dark">${patterns.learningStyle.recommendation}</p>
                        </div>
                    </div>
                `;

                // Display risk factors
                const risksContainer = document.getElementById('risk-factors');
                if (patterns.riskFactors.length > 0) {
                    risksContainer.innerHTML = patterns.riskFactors.map(risk => `
                        <div class="p-2 bg-red-100 dark:bg-red-900/20 rounded">
                            <p class="text-sm font-medium">${risk.factor.replace(/_/g, ' ').toUpperCase()}</p>
                            <p class="text-xs text-subtle-light dark:text-subtle-dark">${risk.recommendation}</p>
                        </div>
                    `).join('');
                } else {
                    risksContainer.innerHTML = '<div class="p-2 bg-green-100 dark:bg-green-900/20 rounded text-center"><p class="text-sm">No risk factors identified</p></div>';
                }

                // Display success probability
                const successContainer = document.getElementById('ai-recommendations');
                successContainer.innerHTML = `
                    <div class="p-3 bg-blue-100 dark:bg-blue-900/20 rounded-lg">
                        <h4 class="font-semibold text-sm">Success Probability</h4>
                        <p class="text-lg font-bold text-blue-600 dark:text-blue-400">
                            ${(prediction.successProbability * 100).toFixed(1)}%
                        </p>
                        <p class="text-xs text-subtle-light dark:text-subtle-dark mt-1">
                            ${prediction.recommendation}
                        </p>
                    </div>
                `;
            }

            function stopCamera() {
                if (cameraStream) {
                    cameraStream.getTracks().forEach(track => track.stop());
                    cameraStream = null;
                }
                
                if (detectionInterval) {
                    clearInterval(detectionInterval);
                    detectionInterval = null;
                }
                
                document.getElementById('camera-section').classList.add('hidden');
                console.log('✅ Camera stopped');
            }
        });
    </script>
</body>
</html>


